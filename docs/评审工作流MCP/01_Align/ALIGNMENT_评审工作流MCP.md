# ALIGNMENT_评审工作流MCP

## 1. 业务上下文分析

### 1.1 原始需求
用户希望将“评审工作流”（6A工作流）封装为一个 MCP Server，目的是“控制大模型按照规定的工作流稳定可靠的完成任务”。

### 1.2 核心痛点
- 大模型在执行复杂任务时容易发散，缺乏严谨的步骤控制。
- 评审过程需要产生大量标准文档，手动管理繁琐且易出错。
- 缺乏状态记忆，难以保证从“对齐”到“评估”的连贯性。

### 1.3 业务实体
- **Workflow (工作流)**: 整个评审过程的生命周期管理。
- **Stage (阶段)**: 6A 的各个阶段 (Align, Architect, Atomize, Approve, Automate, Assess, Extend)。
- **Document (文档)**: 每个阶段产出的 Markdown 文件（如 ALIGNMENT_xxx.md, DESIGN_xxx.md）。
- **Checklist (检查项)**: 每个阶段的质量门控标准。
- **Task (任务)**: 评审中的具体原子任务。

## 2. 需求理解与共识

### 2.1 核心能力 (Core Capabilities)
本 MCP Server 将作为“流程向导”和“执行工具箱”，提供以下能力：

1.  **工作流状态管理 (State Management)**
    - 初始化工作流。
    - 记录当前所处阶段。
    - 验证前置条件，控制阶段流转（只有通过质量门控才能进入下一阶段）。

2.  **标准化文档操作 (Document Operations)**
    - 提供模板化的文档创建工具。
    - 读取和更新特定阶段的文档。
    - 自动维护文档目录结构。

3.  **质量门控 (Quality Gates)**
    - 提供工具让 LLM 确认当前阶段的 Checklist。
    - 记录审批状态。

4.  **上下文引导 (Context Guidance)**
    - 提供 `get_current_step` 工具，告诉 LLM 当前应该做什么，下一步做什么。
    - 注入当前阶段所需的系统提示词或规则。

### 2.2 目标用户
- 使用 Trae 或 Claude Desktop 的开发者。
- 希望让 AI 辅助完成系统化设计和评审的架构师/PM。

### 2.3 依赖系统
- **本地文件系统**: 用于存储生成的 Markdown 文档。
- **Python 环境**: 运行 MCP Server。

## 3. 关键决策点 (Key Decisions)

- **Q: MCP 是被动工具还是主动代理？**
  - A: MCP 本质是工具集合。但我们将设计 `get_next_instruction` 类型的工具，让 LLM 在每一轮对话中主动查询“我现在该干什么”，从而实现“控制”的效果。
- **Q: 状态存储在哪里？**
  - A: 状态应持久化存储，建议使用本地 JSON 文件 (`workflow_state.json`) 存储在文档目录下，以便跨会话记忆。
- **Q: 如何处理多轮评审？**
  - A: 文件命名支持版本或覆盖，状态机应支持“驳回”或“重来”。

## 4. 待澄清事项
- 无。
