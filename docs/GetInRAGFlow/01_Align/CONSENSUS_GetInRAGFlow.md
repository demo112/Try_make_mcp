# é˜¶æ®µ1ï¼šå…±è¯† - GetInRAGFlow v2.2

## 1. éœ€æ±‚å®šä¹‰
æ„å»ºä¸€ä¸ªæ·±åº¦é›†æˆäº 6A å·¥ä½œæµçš„ **æ™ºèƒ½çŸ¥è¯†æ²»ç†ç³»ç»Ÿ**ã€‚
ä¸ä»…ä»…æ˜¯å›ç­”é—®é¢˜ï¼Œæ›´æ˜¯ç®¡ç†è¯„å®¡è¿‡ç¨‹ä¸­çŸ¥è¯†çš„æµåŠ¨ã€éªŒè¯ä¸æ²‰æ·€ï¼Œå¹¶ç¡®ä¿ç³»ç»Ÿçš„**å¯é æ€§**ä¸**çœŸå®æ€§**ã€‚

## 2. æ ¸å¿ƒå…±è¯†

### 2.1 çŸ¥è¯†åˆ†å±‚ä¸éš”ç¦»
å¿…é¡»ä¸¥æ ¼éµå®ˆä»¥ä¸‹åˆ†å±‚ï¼Œé˜²æ­¢çŸ¥è¯†æ±¡æŸ“ï¼š
- **L1 å…¨å±€ (é‡‘æ ‡)**: å…¨ä¼ä¸šé€šç”¨çš„è§„èŒƒï¼ˆå¦‚å®‰å…¨çº¢çº¿ã€ç¼–ç è§„èŒƒï¼‰ã€‚**[é¡¹ç›®åªè¯»]**
- **L2 äº§å“ (é‡‘æ ‡)**: ç‰¹å®šäº§å“çº¿çš„ç¨³å®šçŸ¥è¯†ï¼ˆå¦‚æ”¯ä»˜ç½‘å…³æ¥å£å®šä¹‰ï¼‰ã€‚**[é¡¹ç›®åªè¯»]**
- **L3 é¡¹ç›® (ä¸´æ—¶)**: å½“å‰è¯„å®¡é¡¹ç›®äº§ç”Ÿçš„ä¸´æ—¶çŸ¥è¯†ã€‚**[è¯»å†™]**

### 2.2 å¼ºåˆ¶æŠ€æœ¯å¡ç‚¹
ç³»ç»Ÿå¿…é¡»åœ¨ä»£ç å±‚é¢å¼ºåˆ¶æ‰§è¡Œä»¥ä¸‹æ£€æŸ¥ï¼Œ**ä¸å…è®¸ç»•è¿‡**ï¼š
1.  **å¡ç‚¹ 1: åˆå§‹åŒ–æ£€æŸ¥**
    - `init_review` æ—¶ï¼Œå¿…é¡»æ£€æµ‹ `ALIGNMENT` æ–‡æ¡£æ˜¯å¦å­˜åœ¨åˆæ³•çš„ YAML å‰ç½®å…ƒæ•°æ® (äº§å“/æ¨¡å—)ã€‚
    - **å¤±è´¥åŠ¨ä½œ**: æŠ¥é”™å¹¶æ‹’ç»åˆå§‹åŒ–åç»­æ–‡æ¡£ã€‚
2.  **å¡ç‚¹ 2: éªŒè¯æ£€æŸ¥**
    - `harvest_knowledge` åï¼Œå¿…é¡»è‡ªåŠ¨è§¦å‘ `GovernanceEngine.validate_conflict`ã€‚
    - **å¤±è´¥åŠ¨ä½œ**: æ ‡è®°å†²çªæ¡ç›®ï¼Œç¦æ­¢è‡ªåŠ¨å…¥åº“ã€‚
3.  **å¡ç‚¹ 3: æ™‹å‡æ£€æŸ¥**
    - `promote_knowledge` æ—¶ï¼Œå¿…é¡»æ£€æµ‹ `Promotion_Request.md` æ˜¯å¦åŒ…å«æœ‰æ•ˆçš„æ¶æ„å¸ˆç­¾å (`[Approved by: ...]`)ã€‚
    - **å¤±è´¥åŠ¨ä½œ**: æ‹’ç»å†™å…¥ L1/L2 çŸ¥è¯†åº“ã€‚
4.  **å¡ç‚¹ 4: çœŸå®æ€§æ£€æŸ¥**
    - åœ¨ç”Ÿæˆå»ºè®®å‰ï¼Œå¿…é¡»è¯„ä¼°æ£€ç´¢å†…å®¹çš„ç½®ä¿¡åº¦ã€‚
    - **å¤±è´¥åŠ¨ä½œ**: è‹¥ç½®ä¿¡åº¦ä½äºé˜ˆå€¼ï¼Œå¿…é¡»æ˜ç¡®è¾“å‡ºâ€œæœªæ‰¾åˆ°ç›¸å…³ä¿¡æ¯â€ï¼Œä¸¥ç¦ç¼–é€ ã€‚

### 2.3 å¯é æ€§ä¸å®¹é”™ç­–ç•¥
ä¸ºäº†åº”å¯¹å¤–éƒ¨ä¾èµ–çš„ä¸ç¡®å®šæ€§ï¼Œå¿…é¡»å®ç°ä»¥ä¸‹æœºåˆ¶ï¼š
1.  **è‡ªåŠ¨é‡è¯•æœºåˆ¶**:
    - é’ˆå¯¹ RAGFlow API è°ƒç”¨å’Œ LLM æ¨ç†ï¼Œå®æ–½æŒ‡æ•°é€€é¿ (Exponential Backoff) é‡è¯•ç­–ç•¥ã€‚
    - æœ€å¤§é‡è¯•æ¬¡æ•°ï¼š3æ¬¡ã€‚
2.  **é™çº§ç­–ç•¥ (Fallback)**:
    - è‹¥ RAG æœåŠ¡ä¸å¯ç”¨ï¼šé™çº§ä¸ºä»…è¿›è¡Œæœ¬åœ°è§„åˆ™æ£€æŸ¥ï¼Œæˆ–åœ¨æ–‡æ¡£ä¸­æ ‡è®°â€œæœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·äººå·¥æŸ¥é˜…â€ã€‚
    - è‹¥ LLM å“åº”è¶…æ—¶ï¼šè·³è¿‡å½“å‰æ¡ç›®çš„å»ºè®®ç”Ÿæˆï¼Œä¸é˜»å¡æ•´ä¸ªæ–‡æ¡£çš„å¤„ç†ã€‚
3.  **å¼‚å¸¸å¤„ç†**:
    - æ‰€æœ‰æ¨¡å—å¿…é¡»æ•è·å¼‚å¸¸ï¼Œå¹¶è®°å½•è¯¦ç»†æ—¥å¿—ï¼ˆåŒ…æ‹¬ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼‰ã€‚
    - ä¸¥ç¦å› å•ä¸ªæ¡ç›®çš„å¤„ç†å¤±è´¥å¯¼è‡´æ•´ä¸ªç¨‹åºå´©æºƒã€‚

### 2.4 äº¤äº’ä¸è¾“å‡ºè§„èŒƒ (Interaction & Output Standards) - **NEW**
1.  **å•ç‚¹èšç„¦ (Single Focus)**:
    - AI åœ¨å›ç­”é—®é¢˜æ—¶ï¼Œå¿…é¡»**æ¯æ¬¡ä»…èšç„¦å›ç­”ä¸€ä¸ªé—®é¢˜**ã€‚
    - ä¸¥ç¦åˆå¹¶å›ç­”æˆ–åœ¨ä¸€æ¬¡å›ç­”ä¸­æ··æ‚æ— å…³ä¿¡æ¯ã€‚
2.  **è¾“å‡ºæ ¼å¼ (Structured Output)**:
    - AI è§£ç­”å¿…é¡»å…·å¤‡æ˜æ˜¾æ ‡è¯†ã€æ¥æºåŠç½®ä¿¡åº¦ã€‚
    - **æ ‡å‡†æ ¼å¼**:
      ```markdown
      > ğŸ¤– **AI è§£ç­”** (ç½®ä¿¡åº¦: 0.85)
      >
      > [æ­¤å¤„ä¸º AI ç”Ÿæˆçš„å…·ä½“å›ç­”å†…å®¹]
      >
      > ğŸ“š **æ¥æº**:
      > - `æ–‡æ¡£åç§°.md` (ç« èŠ‚: 3.1 æ ¸å¿ƒæ¶æ„)
      ```
3.  **æ–‡æ¡£ä¼˜å…ˆ**: æ‰€æœ‰çš„è¾“å…¥ï¼ˆé—®é¢˜ï¼‰å’Œè¾“å‡ºï¼ˆç­”æ¡ˆã€å®¡æ‰¹å•ï¼‰å¿…é¡»ä»¥ Markdown æ–‡æ¡£ä¸ºè½½ä½“ã€‚
4.  **ç‹¬ç«‹å­—æ®µ**: AI ç”Ÿæˆçš„å†…å®¹å¿…é¡»å†™å…¥ `**AI å‚è€ƒå»ºè®®**`ï¼Œä¸¥ç¦è§¦ç¢° `**å›ç­”**` å­—æ®µã€‚
5.  **äººå·¥æœ€ç»ˆå†³ç­–**: åªæœ‰ `**å›ç­”**` å­—æ®µçš„å†…å®¹ä¼šè¢«æ”¶å‰²è¿›çŸ¥è¯†åº“ã€‚

## 3. æŠ€æœ¯å®ç°è¾¹ç•Œ
- **åè®®**: MCP (Model Context Protocol) over Stdioã€‚
- **æ ¸å¿ƒä¾èµ–**: 
    - RAGFlow API (æä¾›å‘é‡æ£€ç´¢ä¸ LLM èƒ½åŠ›)ã€‚
    - Python 3.10+ (é€»è¾‘å±‚)ã€‚
- **äº¤ä»˜ç‰©**: 
    - `rag_flow_mcp` (åŒ…å« æ¨ç†ã€æ²»ç†ã€ç”Ÿå‘½å‘¨æœŸã€è¿›åŒ– å››å¤§å¼•æ“)ã€‚
    - é¢„ç½®çš„ MCP å·¥å…· (`fill_clarification_suggestions`, `evolve_scheme_document`, `check_metadata_compliance`, `validate_knowledge_conflict`, `harvest_knowledge_candidates`, `promote_knowledge`, `list_knowledge_bases`, `list_knowledge_base_files`)ã€‚

## 5. ç”Ÿäº§ç¯å¢ƒå‡çº§å…±è¯† (v2.1 P0)
### 5.1 ç¨³å¥æ€§å…±è¯†
*   **AST ä¼˜å…ˆ**: æ‰€æœ‰çš„æ–‡æ¡£ä¿®æ”¹æ“ä½œï¼ˆå¦‚è¿›åŒ–ã€å¡«å……å»ºè®®ï¼‰å¿…é¡»åŸºäº Markdown ASTã€‚ç¦æ­¢ä½¿ç”¨æ­£åˆ™æˆ–çº¯å­—ç¬¦ä¸²æ›¿æ¢æ¥å¤„ç†å¤æ‚çš„æ–‡æ¡£ç»“æ„ã€‚
*   **ç»“æ„ä¿æŠ¤**: åœ¨ä¿®æ”¹æ–‡æ¡£æ—¶ï¼Œå¿…é¡»æ˜¾å¼æ ¡éªŒä¿®æ”¹å‰åçš„ DOM ç»“æ„å·®å¼‚ï¼Œç¡®ä¿ H1-H6 å±‚çº§ã€è¡¨æ ¼åˆ—æ•°ã€Mermaid ä»£ç å—æœªè¢«ç ´åã€‚

### 5.2 åä½œå…±è¯† (è½»é‡åŒ–)
*   **å½±å­å‰¯æœ¬æœºåˆ¶ (Shadow Copy)**:
    *   MCP **ä¸¥ç¦**ç›´æ¥ä¿®æ”¹åŸ Markdown æ–‡ä»¶ï¼ˆå¦‚ `DESIGN.md`ï¼‰ã€‚
    *   æ‰€æœ‰çš„å†™æ“ä½œå¿…é¡»è¾“å‡ºåˆ° `{filename}_ai_revision.md`ã€‚
    *   åŒæ—¶ç”Ÿæˆ `{filename}_diff_report.md`ï¼Œä»¥ç›´è§‚å±•ç¤ºä¿®æ”¹å†…å®¹ã€‚
    *   **äººå·¥ç¡®è®¤**: ç”¨æˆ·é€šè¿‡æ–‡ä»¶å¯¹æ¯”å·¥å…·ç¡®è®¤æ— è¯¯åï¼Œæ‰‹åŠ¨æ‰§è¡Œè¦†ç›–æˆ–åˆå¹¶ã€‚

### 5.3 è´¨é‡å…±è¯†
*   **æµ‹è¯•é—¨ç¦**:
    *   é¡¹ç›®æ ¹ç›®å½•ä¸‹ç»´æŠ¤ `tests/golden_dataset.json`ã€‚
    *   CI æˆ–å‘å¸ƒå‰å¿…é¡»è¿è¡Œ `python tests/run_inference_test.py`ã€‚
    *   **é€šè¿‡æ ‡å‡†**: å¹³å‡è¯­ä¹‰ç›¸ä¼¼åº¦ score > 0.8 (ä½¿ç”¨è½»é‡çº§ LLM æˆ– Embedding Distance åˆ¤å®š)ã€‚

